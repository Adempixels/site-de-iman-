<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>shr-gbl Boutique</title>

<style>
body{
margin:0;
font-family:Arial, sans-serif;
background:linear-gradient(180deg,#fff0f8,#ffe2f1);
color:#2b1030;
}
.container{width:95%;max-width:1200px;margin:30px auto 120px;}
h1{margin:0;font-size:32px}
.sub{margin-top:5px;color:#6b3f6e;line-height:1.35}

.grid{display:grid;grid-template-columns:1fr 2fr;gap:20px;margin-top:20px;align-items:start;}
@media(max-width:900px){.grid{grid-template-columns:1fr;}}

.card{
background:white;
padding:20px;
border-radius:20px;
box-shadow:0 15px 40px rgba(0,0,0,.10);
}
.controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center}

input, textarea, select{
width:100%;
padding:10px;
border-radius:12px;
border:1px solid rgba(0,0,0,.10);
outline:none;
font-family:inherit;
}
textarea{min-height:90px;resize:vertical}

button{
padding:10px 15px;
border:none;
border-radius:12px;
cursor:pointer;
font-weight:bold;
}
.btn{
background:linear-gradient(90deg,#ff4fa3,#ff86c6);
color:white;
}
.btn-outline{
background:white;
border:2px solid #ff4fa3;
color:#ff4fa3;
}
.btn-danger{
background:linear-gradient(90deg,#ff5b5b,#ff9a9a);
color:#240909;
}

.products{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
gap:15px;
margin-top:15px;
}
.product{
background:white;
border-radius:18px;
overflow:hidden;
box-shadow:0 10px 30px rgba(0,0,0,.10);
display:flex;
flex-direction:column;
}
.product img{width:100%;height:220px;object-fit:cover;background:#f7f2f6}
.product-body{padding:15px;display:flex;flex-direction:column;gap:8px;flex:1}
.price{color:#b0005f;font-weight:bold}
.meta{color:#6b3f6e;font-size:12px}

.admin-btn{
position:fixed;bottom:15px;right:15px;
background:white;border:1px solid #ff4fa3;
padding:10px 15px;border-radius:50px;
cursor:pointer;box-shadow:0 15px 40px rgba(0,0,0,.10);
}

.modal{
position:fixed;inset:0;background:rgba(0,0,0,.5);
display:flex;align-items:center;justify-content:center;
padding:16px;
}
.hidden{display:none;}
.modal-content{
background:white;
padding:22px;
border-radius:20px;
width:100%;
max-width:920px;
box-shadow:0 18px 50px rgba(0,0,0,.22);
}
.modal-head{
display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:12px;
}

table{
width:100%;
border-collapse:collapse;
margin-top:12px;
overflow:hidden;
border-radius:14px;
border:1px solid rgba(0,0,0,.08);
}
th, td{
padding:10px;
border-bottom:1px solid rgba(0,0,0,.06);
text-align:left;
vertical-align:top;
font-size:13px;
}
th{background:rgba(255,79,163,.08);color:#2b1030}
tr:last-child td{border-bottom:none}
.rowBtns{display:flex;gap:8px;flex-wrap:wrap}
.small{font-size:12px;color:#6b3f6e}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>

<body>
<div class="container">
<h1>shr-gbl</h1>
<p class="sub">
Boutique de v√™tements ‚Ä¢ Prix en <b>DZD</b> ‚Ä¢ Pas d‚Äôachat en ligne.<br>
üöö Livraison disponible √† <b>Ouled Rechache</b> et dans les villes proches.
</p>

<div class="grid">
<!-- CONTACT -->
<div class="card">
<h3>Contact</h3>
<div class="controls">
<button class="btn" onclick="openWhatsApp()">üì≤ Ouvrir WhatsApp</button>
<button class="btn-outline" onclick="sendEmail()">‚úâÔ∏è Envoyer un Email</button>
</div>
<p class="small" style="margin-top:10px;">
Les clients ne voient pas le num√©ro. Ils cliquent simplement sur WhatsApp / Email.
</p>
</div>

<!-- CATALOGUE -->
<div class="card">
<h3>Catalogue</h3>
<div class="products" id="products">Chargement‚Ä¶</div>
</div>
</div>
</div>

<button class="admin-btn" onclick="openAdminLogin()">üîê Admin</button>

<!-- ADMIN LOGIN -->
<div class="modal hidden" id="adminLoginModal">
<div class="modal-content" style="max-width:420px;">
<div class="modal-head">
<h3 style="margin:0;">Connexion Admin</h3>
<button class="btn-outline" onclick="closeAdminLogin()">Fermer</button>
</div>
<input type="password" id="adminPass" placeholder="Mot de passe admin" />
<div style="height:10px;"></div>
<button class="btn" onclick="loginAdmin()">Connexion</button>
</div>
</div>

<!-- ADMIN PANEL -->
<div class="modal hidden" id="adminPanelModal">
<div class="modal-content">
<div class="modal-head">
<div>
<h3 style="margin:0;">Admin ‚Äî Gestion des v√™tements</h3>
<div class="small">Ajouter ‚Ä¢ Modifier ‚Ä¢ Supprimer (Firebase Realtime Database)</div>
</div>
<button class="btn-outline" onclick="closeAdminPanel()">Fermer</button>
</div>

<div class="card" style="padding:14px;background:#fff7fb;border:1px solid rgba(255,79,163,.15);">
<h4 style="margin:0 0 10px;">‚ûï Ajouter / ‚úèÔ∏è Modifier</h4>

<div class="controls" style="gap:12px;">
<div style="flex:1;min-width:220px;">
<label class="small">Nom</label>
<input id="pName" placeholder="Ex: Robe rose" />
</div>

<div style="width:200px;min-width:180px;">
<label class="small">Prix (DZD)</label>
<input id="pPrice" type="number" placeholder="Ex: 2500" />
</div>

<div style="width:220px;min-width:200px;">
<label class="small">Tailles</label>
<input id="pSizes" placeholder="Ex: S,M,L" />
</div>
</div>

<div class="controls" style="gap:12px;margin-top:10px;">
<div style="flex:1;min-width:240px;">
<label class="small">Cat√©gorie</label>
<input id="pCategory" placeholder="Ex: Robes" />
</div>

<div style="flex:1;min-width:240px;">
<label class="small">R√©f√©rence (optionnel)</label>
<input id="pRef" placeholder="Ex: SHR-001" />
</div>
</div>

<div style="margin-top:10px;">
<label class="small">Lien de photo (optionnel)</label>
<input id="pImage" placeholder="https://..." />
</div>

<div style="margin-top:10px;">
<label class="small">Description</label>
<textarea id="pDesc" placeholder="D√©cris le v√™tement (mati√®re, couleur, d√©tails...)"></textarea>
</div>

<div class="controls" style="justify-content:flex-end;margin-top:10px;">
<span class="small" id="editHint" style="margin-right:auto;"></span>
<button class="btn-outline" onclick="clearForm()">Effacer</button>
<button class="btn" onclick="saveProduct()">Enregistrer</button>
</div>
</div>

<div style="height:14px;"></div>

<div class="card">
<h4 style="margin:0 0 10px;">üì¶ Liste des produits</h4>
<div class="small">Clique ‚ÄúModifier‚Äù pour remplir le formulaire, ou ‚ÄúSupprimer‚Äù.</div>

<table>
<thead>
<tr>
<th>Nom</th>
<th>Prix</th>
<th>Cat√©gorie</th>
<th>Tailles</th>
<th>Date</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="adminTableBody">
<tr><td colspan="6">Chargement‚Ä¶</td></tr>
</tbody>
</table>
</div>
</div>
</div>

<script>
/* ========= Firebase ========= */
const firebaseConfig = {
apiKey: "AIzaSyBXn_hSQShtznZYPcLl-66jKDTSoQttyxg",
authDomain: "site-de-iman.firebaseapp.com",
databaseURL: "https://site-de-iman-default-rtdb.europe-west1.firebasedatabase.app",
projectId: "site-de-iman"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const productsRef = db.ref("products");

/* ========= Boutique ========= */
const SHOP_PHONE = "213655622411";
const SHOP_EMAIL = "imanboutique67@gmail.com";

/* ========= Admin ========= */
const ADMIN_PASSWORD = "DzShr@Gbl$7281";
let ALL = []; // {key, ...data}
let EDIT_KEY = null; // key en cours de modification

function openWhatsApp(){
window.open("https://wa.me/" + SHOP_PHONE, "_blank");
}
function sendEmail(){
window.location.href = "mailto:" + SHOP_EMAIL;
}

/* ========= Catalogue ========= */
function esc(s){
return String(s ?? "").replace(/[&<>"']/g, m => ({
"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"
}[m]));
}
function dzd(n){
return (Number(n||0).toLocaleString("fr-FR")) + " DZD";
}
function formatDate(ts){
if(!ts) return "-";
const d = new Date(ts);
return d.toLocaleDateString("fr-FR") + " " + d.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"});
}

function renderCatalogue(){
const box = document.getElementById("products");
if(!ALL.length){
box.innerHTML = "Aucun produit.";
return;
}
let html = "";
ALL
.slice()
.sort((a,b)=>(b.createdAt||0)-(a.createdAt||0))
.forEach(p=>{
html += `
<div class="product">
${p.image ? `<img src="${esc(p.image)}" alt="${esc(p.name)}">` : `<div style="height:220px;display:flex;align-items:center;justify-content:center;background:#f7f2f6;color:#6b3f6e;font-weight:bold;">üì∑ Photo √† ajouter</div>`}
<div class="product-body">
<b>${esc(p.name || "")}</b>
<div>${esc(p.description || "")}</div>
<div class="meta">${esc(p.category||"")} ${p.ref ? "‚Ä¢ R√©f: "+esc(p.ref):""}</div>
<div class="meta">Tailles: <b>${esc((p.sizes||[]).join(", ") || "‚Äî")}</b></div>
<div class="price">${dzd(p.priceDZD)}</div>
<button class="btn" onclick="openWhatsApp()">Contacter</button>
</div>
</div>`;
});
box.innerHTML = html;
}

/* ========= Admin UI ========= */
function openAdminLogin(){
document.getElementById("adminLoginModal").classList.remove("hidden");
document.getElementById("adminPass").value = "";
}
function closeAdminLogin(){
document.getElementById("adminLoginModal").classList.add("hidden");
}
function loginAdmin(){
const pass = document.getElementById("adminPass").value;
if(pass === ADMIN_PASSWORD){
closeAdminLogin();
document.getElementById("adminPanelModal").classList.remove("hidden");
renderAdminTable();
}else{
alert("Mot de passe incorrect");
}
}
function closeAdminPanel(){
document.getElementById("adminPanelModal").classList.add("hidden");
}

/* ========= Form ========= */
function clearForm(){
EDIT_KEY = null;
document.getElementById("pName").value = "";
document.getElementById("pPrice").value = "";
document.getElementById("pSizes").value = "";
document.getElementById("pCategory").value = "";
document.getElementById("pRef").value = "";
document.getElementById("pImage").value = "";
document.getElementById("pDesc").value = "";
document.getElementById("editHint").textContent = "";
}

function fillForm(p){
EDIT_KEY = p.key;
document.getElementById("pName").value = p.name || "";
document.getElementById("pPrice").value = p.priceDZD ?? "";
document.getElementById("pSizes").value = (p.sizes||[]).join(",");
document.getElementById("pCategory").value = p.category || "";
document.getElementById("pRef").value = p.ref || "";
document.getElementById("pImage").value = p.image || "";
document.getElementById("pDesc").value = p.description || "";
document.getElementById("editHint").textContent = "‚úèÔ∏è Modification : " + (p.name||"");
}

function parseSizes(s){
return String(s||"").split(",").map(x=>x.trim()).filter(Boolean);
}

function saveProduct(){
const name = document.getElementById("pName").value.trim();
const price = Number(document.getElementById("pPrice").value);
const sizes = parseSizes(document.getElementById("pSizes").value);
const category = document.getElementById("pCategory").value.trim();
const ref = document.getElementById("pRef").value.trim();
const image = document.getElementById("pImage").value.trim();
const description = document.getElementById("pDesc").value.trim();

if(!name){ alert("Nom obligatoire"); return; }
if(!category){ alert("Cat√©gorie obligatoire"); return; }
if(!Number.isFinite(price) || price<=0){ alert("Prix DZD invalide"); return; }

const existing = EDIT_KEY ? ALL.find(x=>x.key===EDIT_KEY) : null;

const data = {
name, category, ref, image, description,
sizes,
priceDZD: price,
createdAt: existing?.createdAt || Date.now()
};

if(EDIT_KEY){
productsRef.child(EDIT_KEY).set(data).then(()=>{
alert("‚úÖ Produit mis √† jour !");
clearForm();
}).catch(err=>{
console.error(err);
alert("‚ùå Erreur Firebase (v√©rifie les Rules).");
});
}else{
productsRef.push(data).then(()=>{
alert("‚úÖ Produit ajout√© !");
clearForm();
}).catch(err=>{
console.error(err);
alert("‚ùå Erreur Firebase (v√©rifie les Rules).");
});
}
}

function deleteProduct(key){
if(!confirm("Supprimer ce produit ?")) return;
productsRef.child(key).remove().catch(err=>{
console.error(err);
alert("‚ùå Erreur suppression.");
});
}

function renderAdminTable(){
const tbody = document.getElementById("adminTableBody");
const rows = ALL.slice().sort((a,b)=>(b.createdAt||0)-(a.createdAt||0));

if(!rows.length){
tbody.innerHTML = `<tr><td colspan="6">Aucun produit.</td></tr>`;
return;
}

tbody.innerHTML = rows.map(p=>`
<tr>
<td><b>${esc(p.name)}</b><div class="small">${esc(p.ref||"")}</div></td>
<td>${esc(dzd(p.priceDZD))}</td>
<td>${esc(p.category||"")}</td>
<td>${esc((p.sizes||[]).join(", "))}</td>
<td>${esc(formatDate(p.createdAt))}</td>
<td>
<div class="rowBtns">
<button class="btn-outline" onclick="fillForm(${JSON.stringify({key:p.key})}.key && ALL.find(x=>x.key==='${p.key}') && fillForm(ALL.find(x=>x.key==='${p.key}')) )">Modifier</button>
<button class="btn-danger" onclick="deleteProduct('${p.key}')">Supprimer</button>
</div>
</td>
</tr>
`).join("");
}

/* ========= Live sync ========= */
productsRef.on("value", (snap)=>{
const items = [];
snap.forEach(child=>{
const v = child.val() || {};
items.push({
key: child.key,
name: v.name || "",
category: v.category || "",
ref: v.ref || "",
image: v.image || "",
description: v.description || "",
sizes: Array.isArray(v.sizes) ? v.sizes : [],
priceDZD: Number(v.priceDZD || 0),
createdAt: Number(v.createdAt || 0)
});
});
ALL = items;
renderCatalogue();
// si admin ouvert, refresh table
if(!document.getElementById("adminPanelModal").classList.contains("hidden")){
renderAdminTable();
}
});
</script>
</body>
</html>
